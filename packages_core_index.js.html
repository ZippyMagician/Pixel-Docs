<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>packages/core/index.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Pixel.AnimatedSprite.html">AnimatedSprite</a><ul class='methods'><li data-type='method'><a href="Pixel.AnimatedSprite.html#copy">copy</a></li><li data-type='method'><a href="Pixel.AnimatedSprite.html#reset">reset</a></li><li data-type='method'><a href="Pixel.AnimatedSprite.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.AnimatedSprite.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.AnimatedSprite.html#settings">settings</a></li><li data-type='method'><a href="Pixel.AnimatedSprite.html#spin">spin</a></li></ul></li><li><a href="Pixel.Circle.html">Circle</a><ul class='methods'><li data-type='method'><a href="Pixel.Circle.html#copy">copy</a></li><li data-type='method'><a href="Pixel.Circle.html#reset">reset</a></li><li data-type='method'><a href="Pixel.Circle.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.Circle.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.Circle.html#settings">settings</a></li><li data-type='method'><a href="Pixel.Circle.html#spin">spin</a></li></ul></li><li><a href="Pixel.Container.html">Container</a><ul class='methods'><li data-type='method'><a href="Pixel.Container.html#add">add</a></li><li data-type='method'><a href="Pixel.Container.html#addChild">addChild</a></li><li data-type='method'><a href="Pixel.Container.html#addHitRegion">addHitRegion</a></li><li data-type='method'><a href="Pixel.Container.html#background">background</a></li><li data-type='method'><a href="Pixel.Container.html#cloneChildren">cloneChildren</a></li><li data-type='method'><a href="Pixel.Container.html#on">on</a></li><li data-type='method'><a href="Pixel.Container.html#render">render</a></li></ul></li><li><a href="Pixel.EXPORTS.AnimationCore.html">AnimationCore</a><ul class='methods'><li data-type='method'><a href="Pixel.EXPORTS.AnimationCore.html#add">add</a></li><li data-type='method'><a href="Pixel.EXPORTS.AnimationCore.html#create">create</a></li><li data-type='method'><a href="Pixel.EXPORTS.AnimationCore.html#multiAdd">multiAdd</a></li><li data-type='method'><a href="Pixel.EXPORTS.AnimationCore.html#play">play</a></li><li data-type='method'><a href="Pixel.EXPORTS.AnimationCore.html#stop">stop</a></li></ul></li><li><a href="Pixel.EXPORTS.FillStyle.html">FillStyle</a><ul class='methods'><li data-type='method'><a href="Pixel.EXPORTS.FillStyle.html#clone">clone</a></li><li data-type='method'><a href="Pixel.EXPORTS.FillStyle.html#fill">fill</a></li><li data-type='method'><a href="Pixel.EXPORTS.FillStyle.html#reset">reset</a></li></ul></li><li><a href="Pixel.EXPORTS.ImageGraphics.html">ImageGraphics</a><ul class='methods'><li data-type='method'><a href="Pixel.EXPORTS.ImageGraphics.html#cropRect">cropRect</a></li><li data-type='method'><a href="Pixel.EXPORTS.ImageGraphics.html#loadImage">loadImage</a></li></ul></li><li><a href="Pixel.EXPORTS.SpriteBase.html">SpriteBase</a><ul class='methods'><li data-type='method'><a href="Pixel.EXPORTS.SpriteBase.html#copy">copy</a></li><li data-type='method'><a href="Pixel.EXPORTS.SpriteBase.html#reset">reset</a></li><li data-type='method'><a href="Pixel.EXPORTS.SpriteBase.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.EXPORTS.SpriteBase.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.EXPORTS.SpriteBase.html#settings">settings</a></li><li data-type='method'><a href="Pixel.EXPORTS.SpriteBase.html#spin">spin</a></li></ul></li><li><a href="Pixel.Graphics.html">Graphics</a><ul class='methods'><li data-type='method'><a href="Pixel.Graphics.html#arc">arc</a></li><li data-type='method'><a href="Pixel.Graphics.html#arcTo">arcTo</a></li><li data-type='method'><a href="Pixel.Graphics.html#clearCircle">clearCircle</a></li><li data-type='method'><a href="Pixel.Graphics.html#clearRect">clearRect</a></li><li data-type='method'><a href="Pixel.Graphics.html#cropRect">cropRect</a></li><li data-type='method'><a href="Pixel.Graphics.html#drawRect">drawRect</a></li><li data-type='method'><a href="Pixel.Graphics.html#end">end</a></li><li data-type='method'><a href="Pixel.Graphics.html#fill">fill</a></li><li data-type='method'><a href="Pixel.Graphics.html#loadImage">loadImage</a></li><li data-type='method'><a href="Pixel.Graphics.html#move">move</a></li><li data-type='method'><a href="Pixel.Graphics.html#shadow">shadow</a></li><li data-type='method'><a href="Pixel.Graphics.html#transparency">transparency</a></li></ul></li><li><a href="Pixel.Map.html">Map</a><ul class='methods'><li data-type='method'><a href="Pixel.Map.html#applyTileset">applyTileset</a></li><li data-type='method'><a href="Pixel.Map.html#checkCollisions">checkCollisions</a></li><li data-type='method'><a href="Pixel.Map.html#collideByExclusion">collideByExclusion</a></li><li data-type='method'><a href="Pixel.Map.html#copy">copy</a></li><li data-type='method'><a href="Pixel.Map.html#fill">fill</a></li><li data-type='method'><a href="Pixel.Map.html#generateBlankMap">generateBlankMap</a></li><li data-type='method'><a href="Pixel.Map.html#placeTile">placeTile</a></li><li data-type='method'><a href="Pixel.Map.html#placeTiles">placeTiles</a></li><li data-type='method'><a href="Pixel.Map.html#render">render</a></li><li data-type='method'><a href="Pixel.Map.html#reset">reset</a></li><li data-type='method'><a href="Pixel.Map.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.Map.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.Map.html#settings">settings</a></li><li data-type='method'><a href="Pixel.Map.html#spin">spin</a></li><li data-type='method'><a href="Pixel.Map.html#tileToWorldX">tileToWorldX</a></li><li data-type='method'><a href="Pixel.Map.html#tileToWorldY">tileToWorldY</a></li><li data-type='method'><a href="Pixel.Map.html#weightedRandomize">weightedRandomize</a></li></ul></li><li><a href="Pixel.Point.html">Point</a><ul class='methods'><li data-type='method'><a href="Pixel.Point.html#clone">clone</a></li></ul></li><li><a href="Pixel.Rectangle.html">Rectangle</a><ul class='methods'><li data-type='method'><a href="Pixel.Rectangle.html#copy">copy</a></li><li data-type='method'><a href="Pixel.Rectangle.html#render">render</a></li><li data-type='method'><a href="Pixel.Rectangle.html#reset">reset</a></li><li data-type='method'><a href="Pixel.Rectangle.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.Rectangle.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.Rectangle.html#settings">settings</a></li><li data-type='method'><a href="Pixel.Rectangle.html#spin">spin</a></li></ul></li><li><a href="Pixel.Sound.html">Sound</a></li><li><a href="Pixel.Sprite.html">Sprite</a><ul class='methods'><li data-type='method'><a href="Pixel.Sprite.html#checkCollisions">checkCollisions</a></li><li data-type='method'><a href="Pixel.Sprite.html#clone">clone</a></li><li data-type='method'><a href="Pixel.Sprite.html#copy">copy</a></li><li data-type='method'><a href="Pixel.Sprite.html#render">render</a></li><li data-type='method'><a href="Pixel.Sprite.html#reset">reset</a></li><li data-type='method'><a href="Pixel.Sprite.html#rotation_render">rotation_render</a></li><li data-type='method'><a href="Pixel.Sprite.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.Sprite.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.Sprite.html#settings">settings</a></li><li data-type='method'><a href="Pixel.Sprite.html#spin">spin</a></li></ul></li><li><a href="Pixel.SpriteSheet.html">SpriteSheet</a><ul class='methods'><li data-type='method'><a href="Pixel.SpriteSheet.html#copy">copy</a></li><li data-type='method'><a href="Pixel.SpriteSheet.html#generateSheet">generateSheet</a></li><li data-type='method'><a href="Pixel.SpriteSheet.html#reset">reset</a></li><li data-type='method'><a href="Pixel.SpriteSheet.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.SpriteSheet.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.SpriteSheet.html#settings">settings</a></li><li data-type='method'><a href="Pixel.SpriteSheet.html#spin">spin</a></li></ul></li><li><a href="Pixel.Stage.html">Stage</a><ul class='methods'><li data-type='method'><a href="Pixel.Stage.html#addChild">addChild</a></li><li data-type='method'><a href="Pixel.Stage.html#render">render</a></li></ul></li><li><a href="Pixel.Text.html">Text</a><ul class='methods'><li data-type='method'><a href="Pixel.Text.html#copy">copy</a></li><li data-type='method'><a href="Pixel.Text.html#render">render</a></li><li data-type='method'><a href="Pixel.Text.html#reset">reset</a></li><li data-type='method'><a href="Pixel.Text.html#setAnchor">setAnchor</a></li><li data-type='method'><a href="Pixel.Text.html#setSize">setSize</a></li><li data-type='method'><a href="Pixel.Text.html#settings">settings</a></li><li data-type='method'><a href="Pixel.Text.html#spin">spin</a></li></ul></li><li><a href="Pixel.Texture.html">Texture</a></li></ul><h3>Namespaces</h3><ul><li><a href="Pixel.html">Pixel</a></li><li><a href="Pixel.Container.keyboard.html">keyboard</a><ul class='methods'><li data-type='method'><a href="Pixel.Container.keyboard.html#on">on</a></li></ul></li><li><a href="Pixel.EXPORTS.html">EXPORTS</a></li><li><a href="Pixel.Stage.physics.html">physics</a></li><li><a href="Pixel.Stage.physics.collider.html">collider</a><ul class='methods'><li data-type='method'><a href="Pixel.Stage.physics.collider.html#add">add</a></li></ul></li><li><a href="Pixel.Stage.resources.html">resources</a><ul class='methods'><li data-type='method'><a href="Pixel.Stage.resources.html#add">add</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">packages/core/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Container from "./container";

/**
  * The stage controls all things that run in Pixel
  *
  * @class
  * @memberof Pixel
*/

class Stage {

  /**
    * Takes an options object, contains the width and height
    *
    * @constructor
    * @param {object} options - The options rendering parameter
    * @param {number} options.width - The width of the canvas
    * @param {number} options.height - The height of the canvas
    * @param {boolean} [options.ticker=true] - Whether or not the canvas automatically renders every tick
  */

  constructor(options) {
    var canvas = document.createElement("canvas");
    canvas.height = options.height;
    canvas.width = options.width;
    var ctx = canvas.getContext("2d");

    /**
      * The canvas element
      * 
      * @name Pixel.Stage#view
      * @type {HTMLCanvasElement}
    */

    this.view = ctx.canvas;

    /**
      * The primitive drawing function
      * 
      * @name Pixel.Stage#draw
      * @type {CanvasRenderingContext2d}
    */

    this.draw = ctx;

    /**
      * Records whether or not the canvas renders every tick
      * 
      * @private
      * @name Pixel.Stage#tick
      * @type {boolean}
    */

    this.tick = options.ticker === undefined|null ? true : options.ticker;

    /**
      * Current cursor displayed
      * 
      * @private
      * @name Pixel.Stage#cursor
    */

    this.cursor = canvas.style.cursor;

    /**
      * Stores all preloaded textures
      * 
      * @namespace Pixel.Stage.resources
    */

    this.resources = {};

    /**
      * The current stage object
      * 
      * @type {Pixel.Container}
      * @name Pixel.Stage#stage
    */

    this.stage = new Container(this.draw);

    /**
      * The physics storage object
      * 
      * @type {object}
      * @namespace Pixel.Stage.physics
      * @property {object[]} [collisions] - Stores all collision data
      * @property {object} [colliding] - Stores the booleans of every colliding element
    */

    this.physics = {collisions: [], colliding: {} };
   
    /**
      * The collider element, allows to add more collisions
      *
      * @namespace Pixel.Stage.physics.collider
    */
   
    this.physics.collider = {};

    /**
      * Adds new collider
      * 
      * @function Pixel.Stage.physics.collider#add
      * @param {string} name - The name of the collision
      * @param {Pixel.Sprite[]|Pixel.Map[]|Pixel.AnimatedSprite[]} sprite1 - The first sprite(s) that will collide with the second
      * @param {Pixel.Sprite|Pixel.Map|Pixel.AnimatedSprite} sprite2 - The second sprite that collides with the first
    */

    this.physics.collider.add = (name, sprite1, sprite2) => {
      this.physics.collisions.push({name: name, parent: sprite1, child: sprite2});
      this.physics.colliding[name] = false;
    };

    /**
      * Checks if the mouse is inside any described click region
      * 
      * @private
      * @function Pixel.Stage#_checkRegions
      * @param {DocumentEvent} e - The Document Event
      * @param {boolean} [int=true] - Whether or not it will change the cursor
      * @return {boolean} True or False
    */

    this._checkRegions = (e, int = true) => {
      var c = false;
      var mouse = this.stage.mousePos(canvas, e);
      this.stage.mouse = mouse;
      for (var r in this.stage.regions) {
        var reg = this.stage.regions[r];
        if (mouse.x > reg.start.x &amp;&amp; mouse.x &lt; reg.end.x &amp;&amp; mouse.y > reg.start.y &amp;&amp; mouse.y &lt; reg.end.y) {
          if (int) {
            reg.call();
          }
          else {
            canvas.style.cursor = "pointer";
          }
          c = true;
        }
      }
      return c;
    };

    /**
      * Private onclick function manager
      * 
      * @function Pixel.Stage.view#onclick
      * @private
    */

    this.view.onclick = (e) => {
      this._checkRegions(e);
      if (this.onclick) {
        return this.onclick(e);
      }
    };

    /**
      * Private onmousemove function manager
      * 
      * @private
      * @static
    */

    document.onmousemove = (e) => {
      var check = this._checkRegions(e, false);
      if (!check) {
        canvas.style.cursor = this.cursor;
      }
      if (this.stage.onmousemove) {
        return this.stage.onmousemove(e);
      }
    };

    /**
      * Private onmousedown function manager
      * 
      * @private
      * @static
    */

    document.onmousedown = (e) => {
      this.lastClickTarget = e.target;
      if (this.stage.onmousedown) {
        return this.stage.onmousedown(e);
      }
    };

    /**
      * Private onkeydown function manager
      * 
      * @private
      * @static
    */

    document.onkeydown = (e) => {
      let key = e.key;
      let keys = Pixel.Keys;
      for (var ke in keys) {
        if (key === keys[ke]) {
          keys.down[ke] = true;
        }
      }
      if (this.stage.onkeydown) {
        return this.stage.onkeydown(e);
      }
    };

    /**
      * Private onkeyup function manager
      * 
      * @private
      * @static
    */

    document.onkeyup = function(e) {
      let key = e.key;
      let keys = Pixel.Keys;
      for (var ke in keys) {
        if (key === keys[ke]) {
          keys.down[ke] = false;
        }
      }
      if (this.stage.onkeyup) {
        return this.stage.onkeyup(e);
      }
    };

    /**
      * Adds and preloads new Texture element to the resources
      * 
      * @function Pixel.Stage.resources#add
      * @param {string} name - Name this element will refer to
      * @param {string} url - URL That image is loaded from
      * @return {Promise}
      * @example
      * // Example of use where app is an instance of Pixel.Stage
      * app.resources.add('name', 'image/path').then(function (resources) {
      *   let sprite = new Pixel.Sprite(resources.name); // Automatically preloaded as a Pixel.Texture, pass through this
      * 
      *   // ...
      * });
    */

    this.resources.add = (name, url) => {
      var image = new Image();
      return new Promise((resolve, reject) => {
        image.onload = function() {
          this.resources[name] = {
            image: image,
            renderable: true
          };
          return resolve(this.resources);
        };
        image.crossOrigin = "Anonymous";
        image.src = url;
      });
    };

    if ((options.ticker === undefined) | null || options.ticker) {
      window.requestAnimationFrame(this._animFrame.bind(this));
    }
  }

  /**
    * Adds child to stage
    * 
    * @method Pixel.Stage#addChild
    * @param {Pixel.Sprite} sprite - Sprite to be added
  */

  addChild(sprite) {
    this.stage.addChild(sprite);
  }

  /**
    * Renders the entire stage
    * 
    * @method Pixel.Stage#render
  */

  render() {
    var l = this.stage.sprites.length;
    if (l >= 1) {this.stage.clear();}

    this.draw.fillStyle = this.stage._backColor;
    this.draw.fillRect(0, 0, this.view.width, this.view.height);

    for (var i = 0; i &lt; l; i++) {
      this.stage.sprites[i].render(this.draw);
    }
  }

  /**
    * Checks through all collisions
    * 
    * @private
    * @method Pixel.Stage#_checkCollisions
  */

  _checkCollisions() {
    for (let i in this.physics.collisions) {
      let collision = this.physics.collisions[i];
      let name = collision.name;
      let sprite = collision.parent;
      let ret = {top: false, bottom: false, left: false, right: false, body: false};


      if (Array.isArray(sprite)) {
        for (let x in sprite) {
          let spr = sprite[x];
          let col = spr.checkCollisions(collision.child);

          ret.body = col.body === true || ret.body === true ? true : false;
          ret.left = col.left === true || ret.left === true ? true : false;
          ret.right = col.right === true || ret.right === true ? true : false;
          ret.bottom = col.bottom === true || ret.bottom === true ? true : false;
          ret.top = col.top === true || ret.top === true ? true : false;
        }
      } else {ret = sprite.checkCollisions(collision.child);}

      this.physics.colliding[name] = ret;
    }
  }

  /**
    * Animation frame loop
    * 
    * @method Pixel.Stage#_animFrame
    * @private
  */

  _animFrame() {
    this.render();
    window.requestAnimationFrame(this._checkCollisions.bind(this));
    window.requestAnimationFrame(this._tick.bind(this));
    window.requestAnimationFrame(this._animFrame.bind(this));
  }

  /**
    * Ticker manager
    * 
    * @method Pixel.Stage#_tick
    * @private
    * @param {Pixel.Stage} self - Stage anim frame occurs on
  */

  _tick() {
    if (this.tick) {
      this.tick();
    }
  }
}

export {Stage as Stage, Container as Container};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Mon Oct 21 2019 23:17:15 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
